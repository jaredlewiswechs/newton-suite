// ═══════════════════════════════════════════════════════════════════════════════
// OPENDOC — Example Compound Document Application
// ═══════════════════════════════════════════════════════════════════════════════
//
// This demonstrates OpenDoc compound documents in TinyTalk.
// OpenDoc was Apple's 1990s document-centric computing vision.
// Newton OpenDoc brings it back with verified computation.
//
// Run with: POST /foghorn/tinytalk { "code": "<contents>" }
//
// © 2026 Jared Lewis · Ada Computing Company · Houston, Texas
// ═══════════════════════════════════════════════════════════════════════════════

// ---------------------------------------------------------------------------
// 1. CREATE A COMPOUND DOCUMENT
// ---------------------------------------------------------------------------

// Create a new document - this is the container for all parts
let report = Document.new("Q4 Sales Report")

// ---------------------------------------------------------------------------
// 2. ADD TEXT PARTS
// ---------------------------------------------------------------------------

// Introduction section
let intro = TextPart.new(
    "Introduction",
    "This report summarizes Q4 2025 sales performance across all regions."
)

// Executive summary
let summary = TextPart.new(
    "Executive Summary",
    "Revenue increased 23% YoY. APAC led growth with 45% increase."
)

// Add parts to document
Document.add(report, intro)
Document.add(report, summary)

// ---------------------------------------------------------------------------
// 3. ADD TABLE PARTS
// ---------------------------------------------------------------------------

// Sales data table
let sales_data = TablePart.new("Regional Sales", [
    ["Region", "Q3", "Q4", "Change"],
    ["Americas", 1200000, 1450000, "+21%"],
    ["EMEA", 890000, 1020000, "+15%"],
    ["APAC", 650000, 943000, "+45%"],
    ["Total", 2740000, 3413000, "+25%"]
])

Document.add(report, sales_data)

// ---------------------------------------------------------------------------
// 4. ADD A LOGIC PART (Newton Computation)
// ---------------------------------------------------------------------------

// This part contains a verified computation
let calculation = Part.new(
    "logic",
    "Total Revenue Calculator", 
    {"op": "+", "args": [1450000, 1020000, 943000]}
)

Document.add(report, calculation)

// ---------------------------------------------------------------------------
// 5. VERIFY ALL PARTS
// ---------------------------------------------------------------------------

// Verify the entire document
let verification = Document.verify(report)

// ---------------------------------------------------------------------------
// 6. SERIALIZE TO BENTO FORMAT
// ---------------------------------------------------------------------------

// Get the JSON representation (OpenDoc used Bento format)
let json = Document.serialize(report)

// ---------------------------------------------------------------------------
// 7. LIST ALL DOCUMENTS
// ---------------------------------------------------------------------------

let all_docs = Document.all()

// ---------------------------------------------------------------------------
// 8. LIST AVAILABLE PART TYPES
// ---------------------------------------------------------------------------

let types = PartType.list()

// ---------------------------------------------------------------------------
// OUTPUT
// ---------------------------------------------------------------------------

// These values will be returned
{
    "document": report,
    "parts_added": 4,
    "verification": verification,
    "available_types": types,
    "total_documents": all_docs
}
