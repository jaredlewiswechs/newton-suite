<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TinyTalk IDE</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --border: #30363d;
            --text-primary: #f0f6fc;
            --text-secondary: #8b949e;
            --text-muted: #6e7681;
            --accent: #58a6ff;
            --accent-hover: #79c0ff;
            --success: #3fb950;
            --error: #f85149;
            --warning: #d29922;
            --purple: #bc8cff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
        }

        /* Header */
        .header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            padding: 12px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 60px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--accent), var(--purple));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
        }

        .logo-text {
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent), var(--purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-subtitle {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 2px;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* Buttons */
        .btn {
            font-family: inherit;
            font-size: 13px;
            font-weight: 500;
            padding: 8px 16px;
            border-radius: 6px;
            border: 1px solid transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.15s ease;
        }

        .btn-primary {
            background: var(--accent);
            color: #fff;
        }

        .btn-primary:hover {
            background: var(--accent-hover);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-color: var(--border);
        }

        .btn-secondary:hover {
            background: var(--border);
        }

        .btn-icon {
            font-size: 16px;
        }

        /* Select */
        .select-wrapper {
            position: relative;
        }

        .select {
            font-family: inherit;
            font-size: 13px;
            padding: 8px 32px 8px 12px;
            border-radius: 6px;
            border: 1px solid var(--border);
            background: var(--bg-tertiary);
            color: var(--text-primary);
            cursor: pointer;
            appearance: none;
            min-width: 160px;
        }

        .select:focus {
            outline: none;
            border-color: var(--accent);
        }

        .select-arrow {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            color: var(--text-secondary);
        }

        /* Main Layout */
        .main {
            display: flex;
            height: calc(100vh - 60px);
        }

        /* Sidebar */
        .sidebar {
            width: 240px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 16px;
            border-bottom: 1px solid var(--border);
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 8px;
        }

        .example-item {
            padding: 10px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            color: var(--text-secondary);
            transition: all 0.15s ease;
        }

        .example-item:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .example-item.active {
            background: rgba(88, 166, 255, 0.1);
            color: var(--accent);
        }

        /* Editor Container */
        .editor-container {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .editor-header {
            padding: 8px 16px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .file-icon {
            color: var(--accent);
        }

        .file-name {
            color: var(--text-primary);
        }

        .editor-wrapper {
            flex: 1;
            min-height: 0;
        }

        #editor {
            width: 100%;
            height: 100%;
        }

        /* Output Panel */
        .output-panel {
            width: 400px;
            background: var(--bg-secondary);
            border-left: 1px solid var(--border);
            display: flex;
            flex-direction: column;
        }

        .output-header {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .output-title {
            font-size: 13px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .output-title-icon {
            font-size: 16px;
        }

        .status-badge {
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 12px;
            font-weight: 500;
        }

        .status-success {
            background: rgba(63, 185, 80, 0.15);
            color: var(--success);
        }

        .status-error {
            background: rgba(248, 81, 73, 0.15);
            color: var(--error);
        }

        .status-running {
            background: rgba(88, 166, 255, 0.15);
            color: var(--accent);
        }

        .output-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            line-height: 1.6;
        }

        .output-section {
            margin-bottom: 16px;
        }

        .output-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .output-text {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 12px;
            white-space: pre-wrap;
            word-break: break-word;
        }

        .output-text.error {
            border-color: var(--error);
            color: var(--error);
        }

        .output-text.success {
            border-color: var(--success);
        }

        .output-meta {
            display: flex;
            gap: 16px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border);
        }

        .meta-item {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .meta-value {
            color: var(--text-primary);
            font-weight: 500;
        }

        /* Splash / Welcome */
        .welcome {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--text-muted);
            text-align: center;
            padding: 40px;
        }

        .welcome-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .welcome-text {
            font-size: 14px;
            max-width: 280px;
        }

        /* Keyboard shortcuts */
        kbd {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 2px 6px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .sidebar {
                width: 200px;
            }
            .output-panel {
                width: 320px;
            }
        }

        @media (max-width: 900px) {
            .sidebar {
                display: none;
            }
        }

        /* Loading animation */
        .spinner {
            width: 16px;
            height: 16px;
            border: 2px solid var(--bg-tertiary);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <div class="logo-icon">Tt</div>
            <div>
                <div class="logo-text">TinyTalk</div>
                <div class="logo-subtitle">Verified General-Purpose Language</div>
            </div>
        </div>
        <div class="header-actions">
            <div class="select-wrapper">
                <select class="select" id="exampleSelect">
                    <option value="">Load Example...</option>
                </select>
                <span class="select-arrow">‚ñº</span>
            </div>
            <button class="btn btn-primary" id="runBtn" onclick="runCode()">
                <span class="btn-icon">‚ñ∂</span>
                Run
                <kbd>Ctrl+Enter</kbd>
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">üìö Examples</div>
            <div class="sidebar-content" id="examplesList">
                <!-- Examples loaded dynamically -->
            </div>
        </aside>

        <!-- Editor -->
        <div class="editor-container">
            <div class="editor-header">
                <span class="file-icon">üìÑ</span>
                <span class="file-name">untitled.tt</span>
            </div>
            <div class="editor-wrapper">
                <div id="editor"></div>
            </div>
        </div>

        <!-- Output Panel -->
        <aside class="output-panel">
            <div class="output-header">
                <div class="output-title">
                    <span class="output-title-icon">üì§</span>
                    Output
                </div>
                <span class="status-badge" id="statusBadge"></span>
            </div>
            <div class="output-content" id="outputContent">
                <div class="welcome">
                    <div class="welcome-icon">üöÄ</div>
                    <div class="welcome-text">
                        Write some TinyTalk code and press <kbd>Ctrl+Enter</kbd> or click <strong>Run</strong> to execute.
                    </div>
                </div>
            </div>
        </aside>
    </main>

    <!-- Monaco Editor -->
    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.44.0/min/vs/loader.js"></script>
    <script>
        let editor;
        let examples = [];

        // Initialize Monaco
        require.config({ paths: { vs: 'https://cdn.jsdelivr.net/npm/monaco-editor@0.44.0/min/vs' } });
        require(['vs/editor/editor.main'], function () {
            // Register TinyTalk language
            monaco.languages.register({ id: 'tinytalk' });

            // TinyTalk syntax highlighting - Smalltalk inspired
            monaco.languages.setMonarchTokensProvider('tinytalk', {
                keywords: [
                    // tinyTalk sacred keywords (from the Bible)
                    'when', 'and', 'fin', 'finfr', 'ratio', 'blueprint', 'law', 'forge',
                    'field', 'reply', 'end', 'self', 'super', 'nil', 'true', 'false',
                    // Smalltalk control flow (messages)
                    'ifTrue', 'ifFalse', 'whileTrue', 'whileFalse', 'timesRepeat',
                    'do', 'collect', 'select', 'reject', 'inject', 'detect',
                    // Matter types
                    'Money', 'Mass', 'Distance', 'Temperature', 'Pressure', 'Velocity', 'Time', 'Volume'
                ],
                builtins: [
                    // Smalltalk global objects
                    'Transcript', 'Array', 'OrderedCollection', 'Dictionary', 'Set',
                    'String', 'Number', 'Integer', 'Float', 'Boolean', 'Object', 'Block',
                    // Common messages
                    'show', 'cr', 'print', 'printNl', 'value', 'new', 'size', 'at', 'put',
                    'add', 'remove', 'includes', 'isEmpty', 'first', 'last', 'asString',
                    'asNumber', 'asArray', 'copy', 'yourself', 'class', 'respondsTo'
                ],
                operators: [
                    ':=', '=', '==', '~~', '<', '>', '<=', '>=',
                    '+', '-', '*', '/', '//', '\\\\', '@', ',', ';'
                ],
                symbols: /[:=<>~!@#%&*+\-\/\\|,;.]+/,

                tokenizer: {
                    root: [
                        // Smalltalk comments in double quotes
                        [/"/, 'comment', '@comment'],

                        // Strings in single quotes
                        [/'([^'\\]|\\.)*$/, 'string.invalid'],
                        [/'/, 'string', '@string'],

                        // Symbols (like #symbol)
                        [/#[a-zA-Z_]\w*/, 'string.symbol'],

                        // Numbers
                        [/\d+\.\d+([eE][\-+]?\d+)?/, 'number.float'],
                        [/\d+r[0-9A-Za-z]+/, 'number.radix'],
                        [/\d+/, 'number'],

                        // Block parameters [:x :y |
                        [/\[:/, 'delimiter.bracket', '@blockParams'],

                        // Keywords with colons (like ifTrue:ifFalse:)
                        [/[a-zA-Z_]\w*:/, 'keyword.message'],

                        // Identifiers and keywords
                        [/[a-zA-Z_]\w*/, {
                            cases: {
                                '@keywords': 'keyword',
                                '@builtins': 'predefined',
                                '@default': 'identifier'
                            }
                        }],

                        // Operators
                        [/@symbols/, {
                            cases: {
                                '@operators': 'operator',
                                '@default': ''
                            }
                        }],

                        // Brackets
                        [/[{}()\[\]]/, '@brackets'],
                        [/[|]/, 'delimiter.temp'],
                    ],

                    comment: [
                        [/[^"]+/, 'comment'],
                        [/"/, 'comment', '@pop']
                    ],

                    string: [
                        [/[^\\']+/, 'string'],
                        [/\\./, 'string.escape'],
                        [/'/, 'string', '@pop']
                    ],

                    blockParams: [
                        [/:[a-zA-Z_]\w*/, 'variable.parameter'],
                        [/\s+/, 'white'],
                        [/\|/, 'delimiter.temp', '@pop'],
                    ]
                }
            });

            // Define theme
            monaco.editor.defineTheme('tinytalk-dark', {
                base: 'vs-dark',
                inherit: true,
                rules: [
                    { token: 'keyword', foreground: 'ff7b72', fontStyle: 'bold' },
                    { token: 'keyword.message', foreground: 'ffa657' },  // keyword: selectors
                    { token: 'predefined', foreground: 'd2a8ff' },
                    { token: 'string', foreground: 'a5d6ff' },
                    { token: 'string.escape', foreground: '79c0ff' },
                    { token: 'string.symbol', foreground: '7ee787' },  // #symbols
                    { token: 'number', foreground: '79c0ff' },
                    { token: 'number.float', foreground: '79c0ff' },
                    { token: 'number.radix', foreground: '79c0ff' },
                    { token: 'comment', foreground: '8b949e', fontStyle: 'italic' },
                    { token: 'operator', foreground: 'ff7b72' },
                    { token: 'identifier', foreground: 'f0f6fc' },
                    { token: 'variable.parameter', foreground: 'ffa657', fontStyle: 'italic' },  // :blockParams
                    { token: 'delimiter.temp', foreground: 'ffa657' },  // | for temp vars
                ],
                colors: {
                    'editor.background': '#0d1117',
                    'editor.foreground': '#f0f6fc',
                    'editor.lineHighlightBackground': '#161b22',
                    'editor.selectionBackground': '#264f78',
                    'editorCursor.foreground': '#58a6ff',
                    'editorLineNumber.foreground': '#6e7681',
                    'editorLineNumber.activeForeground': '#f0f6fc',
                }
            });

            // Create editor
            editor = monaco.editor.create(document.getElementById('editor'), {
                value: `// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// Welcome to tinyTalk!
// The friendliest programming language
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

show("Hello World!")

// Variables
let name = "Newton"
let age = 384

// show() with space-separated args - no commas needed!
show("Hello" name)
show(name "is" age "years old")

// Property conversions - no function calls!
show("")
show("=== Property Magic ===")
show("name.len:" name.len)
show("name.upper:" name.upper)
show("age.str:" age.str)
show("age.type:" age.type)

// Pure functions with law
law fib(n)
    if n <= 1 { reply n }
    reply fib(n - 1) + fib(n - 2)
end

show("")
show("=== Fibonacci ===")
for i in range(10) {
    show("fib(" i.str ") =" fib(i))
}
`,
                language: 'tinytalk',
                theme: 'tinytalk-dark',
                fontFamily: "'JetBrains Mono', Consolas, monospace",
                fontSize: 14,
                lineHeight: 24,
                padding: { top: 16, bottom: 16 },
                minimap: { enabled: false },
                scrollBeyondLastLine: false,
                renderLineHighlight: 'all',
                cursorBlinking: 'smooth',
                smoothScrolling: true,
                tabSize: 4,
                insertSpaces: true,
                automaticLayout: true,
            });

            // Keyboard shortcut: Ctrl+Enter to run
            editor.addCommand(monaco.KeyMod.CtrlCmd | monaco.KeyCode.Enter, runCode);

            // Auto-completion - Smalltalk style
            monaco.languages.registerCompletionItemProvider('tinytalk', {
                provideCompletionItems: (model, position) => {
                    const suggestions = [
                        // tinyTalk sacred keywords
                        ...['when', 'and', 'fin', 'finfr', 'ratio', 'blueprint', 'law', 'forge', 'field', 'reply', 'end', 'self', 'super', 'nil', 'true', 'false'].map(k => ({
                            label: k,
                            kind: monaco.languages.CompletionItemKind.Keyword,
                            insertText: k,
                        })),
                        // Global objects
                        ...['Transcript', 'Array', 'OrderedCollection', 'Dictionary', 'Set', 'String', 'Number', 'Object', 'Block'].map(b => ({
                            label: b,
                            kind: monaco.languages.CompletionItemKind.Class,
                            insertText: b,
                        })),
                        // Common messages
                        ...['show:', 'cr', 'value:', 'new', 'size', 'at:', 'put:', 'add:', 'includes:', 'ifTrue:', 'ifFalse:', 'whileTrue:', 'timesRepeat:', 'do:', 'collect:', 'select:'].map(m => ({
                            label: m,
                            kind: monaco.languages.CompletionItemKind.Method,
                            insertText: m.endsWith(':') ? m + ' $0' : m,
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                        })),
                        // Snippets - Smalltalk style
                        {
                            label: 'show',
                            kind: monaco.languages.CompletionItemKind.Snippet,
                            insertText: "Transcript show: '${1:message}'.\nTranscript cr.",
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                            documentation: 'Print to Transcript'
                        },
                        {
                            label: 'block',
                            kind: monaco.languages.CompletionItemKind.Snippet,
                            insertText: '[:${1:x} | ${2:x * 2}]',
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                            documentation: 'Block with parameter'
                        },
                        {
                            label: 'ifTrueIfFalse',
                            kind: monaco.languages.CompletionItemKind.Snippet,
                            insertText: '${1:condition} ifTrue: [${2:trueBlock}] ifFalse: [${3:falseBlock}]',
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                            documentation: 'Conditional expression'
                        },
                        {
                            label: 'timesRepeat',
                            kind: monaco.languages.CompletionItemKind.Snippet,
                            insertText: '${1:5} timesRepeat: [\n\t$0\n]',
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                            documentation: 'Repeat N times'
                        },
                        {
                            label: 'whileTrue',
                            kind: monaco.languages.CompletionItemKind.Snippet,
                            insertText: '[${1:condition}] whileTrue: [\n\t$0\n]',
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                            documentation: 'While loop'
                        },
                        {
                            label: 'vars',
                            kind: monaco.languages.CompletionItemKind.Snippet,
                            insertText: '| ${1:x} ${2:y} |\n${1:x} := ${3:0}.',
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                            documentation: 'Declare temporary variables'
                        },
                        {
                            label: 'blueprint',
                            kind: monaco.languages.CompletionItemKind.Snippet,
                            insertText: 'blueprint ${1:Name}\n\tfield ${2:value}\n\t\n\tlaw ${3:method}\n\t\treply ${4:self}\n\tend\nend',
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                            documentation: 'Class definition (tinyTalk style)'
                        },
                        {
                            label: 'law',
                            kind: monaco.languages.CompletionItemKind.Snippet,
                            insertText: 'law ${1:methodName}: ${2:arg}\n\t$0\n\treply self\nend',
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                            documentation: 'Method definition (tinyTalk style)'
                        },
                    ];
                    return { suggestions };
                }
            });
        });

        // Load examples
        async function loadExamples() {
            try {
                const response = await fetch('/api/examples');
                examples = await response.json();
                
                // Populate sidebar
                const list = document.getElementById('examplesList');
                list.innerHTML = examples.map((ex, i) => `
                    <div class="example-item" onclick="loadExample(${i})">${ex.name}</div>
                `).join('');

                // Populate dropdown
                const select = document.getElementById('exampleSelect');
                select.innerHTML = '<option value="">Load Example...</option>' +
                    examples.map((ex, i) => `<option value="${i}">${ex.name}</option>`).join('');
            } catch (err) {
                console.error('Failed to load examples:', err);
            }
        }

        function loadExample(index) {
            const example = examples[index];
            if (example && editor) {
                editor.setValue(example.code);
                // Update active state
                document.querySelectorAll('.example-item').forEach((el, i) => {
                    el.classList.toggle('active', i === index);
                });
                document.getElementById('exampleSelect').value = index;
            }
        }

        // Handle dropdown change
        document.getElementById('exampleSelect').addEventListener('change', (e) => {
            if (e.target.value !== '') {
                loadExample(parseInt(e.target.value));
            }
        });

        // Run code
        async function runCode() {
            const code = editor.getValue();
            const runBtn = document.getElementById('runBtn');
            const statusBadge = document.getElementById('statusBadge');
            const outputContent = document.getElementById('outputContent');

            // Update UI to running state
            runBtn.disabled = true;
            runBtn.innerHTML = '<div class="spinner"></div> Running...';
            statusBadge.className = 'status-badge status-running';
            statusBadge.textContent = 'Running...';

            try {
                const response = await fetch('/api/run', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code })
                });

                const result = await response.json();

                // Update status
                if (result.success) {
                    statusBadge.className = 'status-badge status-success';
                    statusBadge.textContent = 'Success';
                } else {
                    statusBadge.className = 'status-badge status-error';
                    statusBadge.textContent = 'Error';
                }

                // Build output HTML
                let html = '';

                if (result.output) {
                    html += `
                        <div class="output-section">
                            <div class="output-label">Output</div>
                            <div class="output-text">${escapeHtml(result.output)}</div>
                        </div>
                    `;
                }

                if (result.result) {
                    html += `
                        <div class="output-section">
                            <div class="output-label">Result</div>
                            <div class="output-text success">${escapeHtml(result.result)}</div>
                        </div>
                    `;
                }

                if (result.error) {
                    html += `
                        <div class="output-section">
                            <div class="output-label">Error</div>
                            <div class="output-text error">${escapeHtml(result.error)}</div>
                        </div>
                    `;
                }

                if (!result.output && !result.result && !result.error) {
                    html += `
                        <div class="output-section">
                            <div class="output-text" style="color: var(--text-muted);">No output</div>
                        </div>
                    `;
                }

                html += `
                    <div class="output-meta">
                        <div class="meta-item">
                            ‚è±Ô∏è <span class="meta-value">${result.elapsed_ms}ms</span>
                        </div>
                        <div class="meta-item">
                            ‚úì <span class="meta-value">Verified</span>
                        </div>
                    </div>
                `;

                outputContent.innerHTML = html;

            } catch (err) {
                statusBadge.className = 'status-badge status-error';
                statusBadge.textContent = 'Error';
                outputContent.innerHTML = `
                    <div class="output-section">
                        <div class="output-label">Error</div>
                        <div class="output-text error">Failed to connect to server: ${escapeHtml(err.message)}</div>
                    </div>
                `;
            }

            // Reset button
            runBtn.disabled = false;
            runBtn.innerHTML = '<span class="btn-icon">‚ñ∂</span> Run <kbd>Ctrl+Enter</kbd>';
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Initialize
        loadExamples();
    </script>
</body>
</html>
