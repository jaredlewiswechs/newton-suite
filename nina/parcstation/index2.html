<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>parcStation ‚Äî Built on Proof</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <span class="logo-icon">‚óà</span>
                    <span class="logo-text">parc<span class="accent">Station</span></span>
                </div>
            </div>
            
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Your Territory</div>
                    <div class="stack-list" id="stack-list">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Documents</div>
                    <div class="documents-nav" id="documents-nav">
                        <div class="nav-item" id="nav-documents">
                            <span class="nav-icon">üìÑ</span>
                            <span class="nav-text">All Documents</span>
                        </div>
                    </div>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Cartridges</div>
                    <div class="cartridge-list" id="cartridge-list">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </nav>
            
            <div class="sidebar-footer">
                <div class="newton-status" id="newton-status">
                    <span class="status-indicator online"></span>
                    <span class="status-text">Newton Ready</span>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main">
            <!-- Toolbar -->
            <header class="toolbar">
                <div class="toolbar-left">
                    <button class="btn-icon" id="btn-back" title="Back">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M15 18l-6-6 6-6"/>
                        </svg>
                    </button>
                    <div class="breadcrumb" id="breadcrumb">
                        <span class="breadcrumb-item active">All Stacks</span>
                    </div>
                </div>
                <div class="toolbar-center">
                    <div class="search-box" id="spotlight-trigger">
                        <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/>
                            <path d="M21 21l-4.35-4.35"/>
                        </svg>
                        <input type="text" placeholder="Search... ‚åòK" id="search-input" readonly>
                        <span class="search-shortcut">‚åòK</span>
                    </div>
                </div>
                <div class="toolbar-right">
                    <button class="btn-icon" id="btn-new-stack" title="New Stack">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2"/>
                            <path d="M12 8v8M8 12h8"/>
                        </svg>
                    </button>
                    <button class="btn-icon" id="btn-new-card" title="Quick Card">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <path d="M14 2v6h6M12 18v-6M9 15h6"/>
                        </svg>
                    </button>
                </div>
            </header>

            <!-- Content Area -->
            <div class="content" id="content">
                <!-- Stack Grid View (default) -->
                <div class="view view-stacks" id="view-stacks">
                    <div class="view-header">
                        <h1>Your Territory</h1>
                        <p class="view-subtitle">Knowledge stacks verified by Newton</p>
                    </div>
                    <div class="stack-grid" id="stack-grid">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- Stack Detail View -->
                <div class="view view-stack-detail hidden" id="view-stack-detail">
                    <div class="view-header">
                        <h1 id="stack-detail-title">Stack Name</h1>
                        <div class="stack-meta">
                            <span class="verification-badge" id="stack-verification-badge">
                                <span class="badge-icon">‚úì</span>
                                <span class="badge-text">100% Verified</span>
                            </span>
                        </div>
                    </div>
                    <div class="card-list" id="card-list">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- Card Detail View -->
                <div class="view view-card-detail hidden" id="view-card-detail">
                    <div class="card-detail-panel glass">
                        <div class="card-detail-header">
                            <h2 id="card-detail-title">Card</h2>
                            <span class="card-status" id="card-detail-status">Draft</span>
                        </div>
                        <div class="card-detail-body">
                            <div class="detail-section">
                                <label>Claim</label>
                                <p class="claim-text" id="card-detail-claim"></p>
                            </div>
                            <div class="detail-section">
                                <label>Sources</label>
                                <div class="source-list" id="card-detail-sources">
                                    <!-- Populated by JS -->
                                </div>
                                <button class="btn-text" id="btn-add-source">+ Add Source</button>
                            </div>
                            <div class="detail-section">
                                <label>Verification</label>
                                <div class="verification-panel" id="card-verification-panel">
                                    <!-- Populated by JS -->
                                </div>
                            </div>
                        </div>
                        <div class="card-detail-actions">
                            <button class="btn btn-secondary" id="btn-cancel-card">Cancel</button>
                            <button class="btn btn-primary" id="btn-verify-card">
                                <span class="btn-icon">‚ö°</span>
                                Verify with Newton
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Search Results View -->
                <div class="view view-search hidden" id="view-search">
                    <div class="view-header">
                        <h1>Search Results</h1>
                        <p class="view-subtitle" id="search-query-display"></p>
                    </div>
                    <div class="search-results" id="search-results">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- Documents List View -->
                <div class="view view-documents hidden" id="view-documents">
                    <div class="view-header">
                        <div class="view-header-top">
                            <div>
                                <h1>Documents</h1>
                                <p class="view-subtitle">Author knowledge before verification</p>
                            </div>
                            <button class="btn btn-primary" onclick="app.showNewDocumentSheet()">
                                <span class="btn-icon">+</span>
                                New Document
                            </button>
                        </div>
                    </div>
                    <div class="documents-grid" id="documents-grid">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- Document Editor View -->
                <div class="view view-document-editor hidden" id="view-document-editor">
                    <div class="document-editor-layout">
                        <div class="document-editor-main">
                            <div class="editor-toolbar">
                                <input type="text" class="doc-title-input" id="doc-editor-title" placeholder="Document Title">
                                <div class="editor-actions">
                                    <button class="btn btn-secondary btn-sm" id="btn-mark-claim" title="Mark Selection as Claim">
                                        <span class="btn-icon">üìå</span>
                                        Mark as Claim
                                    </button>
                                    <button class="btn btn-primary btn-sm" id="btn-save-doc" title="Save Document">
                                        <span class="btn-icon">üíæ</span>
                                        Save
                                    </button>
                                </div>
                            </div>
                            <div class="editor-content-area">
                                <textarea class="doc-content-textarea" id="doc-editor-content" placeholder="Start writing... 

Select any text and click 'Mark as Claim' to extract verifiable statements.

Your claims will appear in the sidebar where you can verify them with Newton and promote them to cards."></textarea>
                            </div>
                            <div class="editor-status">
                                <span class="status-text" id="editor-status-text">Ready</span>
                            </div>
                        </div>
                        <aside class="claims-sidebar">
                            <div class="claims-header">
                                <h3>üìå Claims</h3>
                                <span class="claims-count" id="claims-count">0</span>
                            </div>
                            <div class="claims-list" id="doc-claims-list">
                                <!-- Populated by JS -->
                            </div>
                            <div class="claims-footer">
                                <p class="claims-hint">Select text ‚Üí Mark as Claim ‚Üí Verify ‚Üí Promote to Card</p>
                            </div>
                        </aside>
                    </div>
                </div>
            </div>
        </main>

        <!-- Quick Card Sheet -->
        <div class="sheet-overlay hidden" id="sheet-overlay"></div>
        <div class="sheet hidden" id="quick-card-sheet">
            <div class="sheet-header">
                <h2>Quick Card</h2>
                <button class="btn-icon sheet-close" id="close-quick-card">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="sheet-body">
                <p class="sheet-hint">Draft a claim. Newton will help you verify it.</p>
                <div class="form-group">
                    <label for="quick-claim">What do you want to verify?</label>
                    <textarea id="quick-claim" placeholder="e.g., Jasper Lewis owned 200 acres in Brazoria County in 1857"></textarea>
                </div>
                <div class="form-group">
                    <label for="quick-source">Source (optional)</label>
                    <input type="text" id="quick-source" placeholder="e.g., Texas GLO Patent #4521">
                </div>
                <div class="form-group">
                    <label for="quick-stack">Add to Stack</label>
                    <select id="quick-stack">
                        <option value="">‚Äî Keep as draft ‚Äî</option>
                        <!-- Populated by JS -->
                    </select>
                </div>
            </div>
            <div class="sheet-footer">
                <button class="btn btn-secondary" id="btn-cancel-quick">Cancel</button>
                <button class="btn btn-primary" id="btn-save-quick">Save Card</button>
            </div>
        </div>

        <!-- New Stack Sheet -->
        <div class="sheet hidden" id="new-stack-sheet">
            <div class="sheet-header">
                <h2>New Stack</h2>
                <button class="btn-icon sheet-close" id="close-new-stack">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="sheet-body">
                <div class="form-group">
                    <label for="stack-name">Name</label>
                    <input type="text" id="stack-name" placeholder="e.g., Lewis Family History">
                </div>
                <div class="form-group">
                    <label for="stack-desc">Description</label>
                    <textarea id="stack-desc" placeholder="What is this stack about?"></textarea>
                </div>
                <div class="form-group">
                    <label>Color</label>
                    <div class="color-picker" id="color-picker">
                        <button class="color-option selected" data-color="#3B82F6" style="background:#3B82F6"></button>
                        <button class="color-option" data-color="#8B5CF6" style="background:#8B5CF6"></button>
                        <button class="color-option" data-color="#10B981" style="background:#10B981"></button>
                        <button class="color-option" data-color="#F59E0B" style="background:#F59E0B"></button>
                        <button class="color-option" data-color="#EF4444" style="background:#EF4444"></button>
                        <button class="color-option" data-color="#EC4899" style="background:#EC4899"></button>
                    </div>
                </div>
            </div>
            <div class="sheet-footer">
                <button class="btn btn-secondary" id="btn-cancel-stack">Cancel</button>
                <button class="btn btn-primary" id="btn-create-stack">Create Stack</button>
            </div>
        </div>

        <!-- New Document Sheet -->
        <div class="sheet hidden" id="new-document-sheet">
            <div class="sheet-header">
                <h2>New Document</h2>
                <button class="btn-icon sheet-close" onclick="app.hideSheet('new-document-sheet')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="sheet-body">
                <p class="sheet-hint">Create a document to draft and organize knowledge before verification.</p>
                <div class="form-group">
                    <label for="new-doc-title">Title</label>
                    <input type="text" id="new-doc-title" placeholder="e.g., Research Notes on Lewis Family">
                </div>
            </div>
            <div class="sheet-footer">
                <button class="btn btn-secondary" onclick="app.hideSheet('new-document-sheet')">Cancel</button>
                <button class="btn btn-primary" onclick="app.createNewDocument()">Create Document</button>
            </div>
        </div>

        <!-- Promote Claim Sheet -->
        <div class="sheet hidden" id="promote-claim-sheet">
            <div class="sheet-header">
                <h2>Promote to Card</h2>
                <button class="btn-icon sheet-close" onclick="app.hideSheet('promote-claim-sheet')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="sheet-body">
                <p class="sheet-hint">Convert this claim into a verified card in your knowledge base.</p>
                <div class="form-group">
                    <label>Claim</label>
                    <div class="claim-preview glass" id="promote-claim-preview"></div>
                </div>
                <div class="form-group">
                    <label for="promote-stack-select">Add to Stack</label>
                    <select id="promote-stack-select">
                        <!-- Populated by JS -->
                    </select>
                </div>
            </div>
            <div class="sheet-footer">
                <button class="btn btn-secondary" onclick="app.hideSheet('promote-claim-sheet')">Cancel</button>
                <button class="btn btn-primary" onclick="app.promoteClaimToCard()">
                    <span class="btn-icon">‚Üó</span>
                    Promote to Card
                </button>
            </div>
        </div>

        <!-- Add Source Sheet -->
        <div class="sheet sheet-large hidden" id="add-source-sheet">
            <div class="sheet-header">
                <h2>Add Source</h2>
                <button class="btn-icon sheet-close" onclick="app.hideSheet('add-source-sheet')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="sheet-body">
                <div class="source-tabs">
                    <button class="source-tab active" data-tab="url">üîó URL</button>
                    <button class="source-tab" data-tab="wikipedia">üìñ Wikipedia</button>
                    <button class="source-tab" data-tab="arxiv">üìÑ arXiv</button>
                    <button class="source-tab" data-tab="manual">‚úèÔ∏è Manual</button>
                </div>
                
                <!-- URL Tab -->
                <div class="source-tab-content active" id="source-tab-url">
                    <div class="form-group">
                        <label for="source-url">Enter URL</label>
                        <input type="url" id="source-url" placeholder="https://example.com/article">
                    </div>
                    <button class="btn btn-primary" onclick="app.addSourceFromUrl()">Add URL</button>
                </div>
                
                <!-- Wikipedia Tab -->
                <div class="source-tab-content hidden" id="source-tab-wikipedia">
                    <div class="form-group">
                        <label for="source-wiki-search">Search Wikipedia</label>
                        <div class="search-input-group">
                            <input type="text" id="source-wiki-search" placeholder="Search topic...">
                            <button class="btn btn-primary" onclick="app.searchWikipediaForSource()">Search</button>
                        </div>
                    </div>
                    <div class="source-search-results" id="wiki-source-results"></div>
                </div>
                
                <!-- arXiv Tab -->
                <div class="source-tab-content hidden" id="source-tab-arxiv">
                    <div class="form-group">
                        <label for="source-arxiv-search">Search arXiv</label>
                        <div class="search-input-group">
                            <input type="text" id="source-arxiv-search" placeholder="Search papers...">
                            <button class="btn btn-primary" onclick="app.searchArxivForSource()">Search</button>
                        </div>
                    </div>
                    <div class="source-search-results" id="arxiv-source-results"></div>
                </div>
                
                <!-- Manual Tab -->
                <div class="source-tab-content hidden" id="source-tab-manual">
                    <div class="form-group">
                        <label for="source-manual-title">Title</label>
                        <input type="text" id="source-manual-title" placeholder="Source title">
                    </div>
                    <div class="form-group">
                        <label for="source-manual-desc">Description</label>
                        <textarea id="source-manual-desc" placeholder="Describe the source..."></textarea>
                    </div>
                    <button class="btn btn-primary" onclick="app.addManualSource()">Add Source</button>
                </div>
            </div>
        </div>

        <!-- Cartridge Panel (Slide-in) -->
        <div class="cartridge-panel hidden" id="cartridge-panel">
            <div class="cartridge-panel-header">
                <div class="cartridge-panel-title">
                    <span class="cartridge-panel-icon" id="cartridge-panel-icon">üìñ</span>
                    <h3 id="cartridge-panel-name">Wikipedia</h3>
                </div>
                <button class="btn-icon" onclick="app.closeCartridgePanel()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="cartridge-panel-search">
                <input type="text" id="cartridge-search-input" placeholder="Search...">
                <button class="btn btn-primary" id="cartridge-search-btn">Search</button>
            </div>
            <div class="cartridge-panel-results" id="cartridge-results">
                <div class="cartridge-empty">
                    <p>Enter a search term above</p>
                </div>
                <!-- Loading state (shown dynamically) -->
                <div class="cartridge-loading hidden" id="cartridge-loading">
                    <span class="loading-spinner"></span>
                    <p>Searching...</p>
                </div>
            </div>
        </div>

        <!-- Newton Agent Chat Panel -->
        <div class="chat-panel" id="chat-panel">
            <div class="chat-header">
                <div class="chat-header-left">
                    <div class="chat-avatar">üß†</div>
                    <div>
                        <div class="chat-title">Newton Agent</div>
                        <div class="chat-subtitle">Self-verifying AI assistant</div>
                    </div>
                </div>
                <button class="btn-icon" id="close-chat">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="chat-messages" id="chat-messages">
                <div class="chat-message assistant">
                    <div class="chat-message-avatar">üß†</div>
                    <div>
                        <div class="chat-message-content">
                            Hi! I'm Newton Agent. Every claim I make is grounded in evidence. Ask me anything about your stacks, or any question you need verified.
                        </div>
                        <div class="chat-message-meta">
                            <span class="verified">‚úì Grounded response</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="chat-input-area">
                <input type="text" class="chat-input" id="chat-input" placeholder="Ask Newton...">
                <button class="chat-send" id="chat-send">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Chat FAB -->
        <button class="chat-fab" id="chat-fab">üí¨</button>

        <!-- Spotlight Search Modal (Cmd+K) -->
        <div class="spotlight-overlay hidden" id="spotlight-overlay">
            <div class="spotlight-modal">
                <div class="spotlight-header">
                    <svg class="spotlight-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="M21 21l-4.35-4.35"/>
                    </svg>
                    <input type="text" class="spotlight-input" id="spotlight-input" placeholder="Search stacks, cards, Wikipedia, arXiv..." autofocus>
                    <div class="spotlight-shortcut">ESC</div>
                </div>
                <div class="spotlight-results" id="spotlight-results">
                    <div class="spotlight-section">
                        <div class="spotlight-section-title">Quick Actions</div>
                        <div class="spotlight-item" data-action="new-stack">
                            <span class="spotlight-item-icon">üìö</span>
                            <span class="spotlight-item-text">Create New Stack</span>
                            <span class="spotlight-item-hint">‚åòN</span>
                        </div>
                        <div class="spotlight-item" data-action="new-card">
                            <span class="spotlight-item-icon">üìù</span>
                            <span class="spotlight-item-text">Quick Card</span>
                            <span class="spotlight-item-hint">‚åò‚áßN</span>
                        </div>
                        <div class="spotlight-item" data-action="new-document">
                            <span class="spotlight-item-icon">üìÑ</span>
                            <span class="spotlight-item-text">New Document</span>
                            <span class="spotlight-item-hint">‚åòD</span>
                        </div>
                        <div class="spotlight-item" data-action="chat">
                            <span class="spotlight-item-icon">üß†</span>
                            <span class="spotlight-item-text">Ask Newton Agent</span>
                            <span class="spotlight-item-hint">‚åòJ</span>
                        </div>
                    </div>
                    <div class="spotlight-section">
                        <div class="spotlight-section-title">Cartridges</div>
                        <div class="spotlight-item" data-action="wikipedia">
                            <span class="spotlight-item-icon">üìñ</span>
                            <span class="spotlight-item-text">Search Wikipedia</span>
                        </div>
                        <div class="spotlight-item" data-action="arxiv">
                            <span class="spotlight-item-icon">üìÑ</span>
                            <span class="spotlight-item-text">Search arXiv Papers</span>
                        </div>
                        <div class="spotlight-item" data-action="calculate">
                            <span class="spotlight-item-icon">üî¢</span>
                            <span class="spotlight-item-text">Calculator</span>
                        </div>
                    </div>
                </div>
                <div class="spotlight-footer">
                    <span class="spotlight-footer-hint">‚Üë‚Üì Navigate</span>
                    <span class="spotlight-footer-hint">‚Üµ Select</span>
                    <span class="spotlight-footer-hint">‚åòK Spotlight</span>
                </div>
            </div>
        </div>
    </div>

    <script src="webgl-bg.js"></script>
    <script src="app2.js"></script>
</body>
</html>
