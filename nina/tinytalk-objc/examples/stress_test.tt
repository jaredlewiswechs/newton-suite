// ═══════════════════════════════════════════════════════════════
// STRESS TEST - TINYTALK OBJECTIVE-C
// Tests execution bounds, memory handling, and performance
// ═══════════════════════════════════════════════════════════════

blueprint StressCounter
  starts @count at 0
  starts @iterations at 0
  starts @max_reached at 0
  
  // No laws - allow unbounded counting for stress test
  
  when increment
    calc @count plus 1 as new_count
    set @count to new_count
    calc @iterations plus 1 as new_iter
    set @iterations to new_iter
    fin
  
  when increment_by(amount)
    calc @count plus amount as new_count
    set @count to new_count
    fin
  
  when reset
    set @count to 0
    fin
end

blueprint DeepNesting
  starts @level at 0
  starts @value at 1
  
  when nest_level_1
    calc @level plus 1 as l
    set @level to l
    calc @value times 2 as v
    set @value to v
    fin
  
  when nest_level_2
    calc @level plus 2 as l
    set @level to l
    calc @value times 4 as v
    set @value to v
    fin
  
  when deep_calc
    // Multiple calculations in sequence
    calc @value plus 10 as v1
    calc v1 times 2 as v2
    calc v2 minus 5 as v3
    calc v3 div 3 as v4
    set @value to v4
    fin
end

blueprint StringStress
  starts @text at ""
  starts @length at 0
  
  when append(str)
    memo combined starts @text & str
    set @text to combined
    calc @length plus 1 as new_len
    set @length to new_len
    fin
  
  when append_with_space(str)
    memo combined starts @text + str
    set @text to combined
    fin
  
  when clear
    set @text to ""
    set @length to 0
    fin
end

blueprint CollectionStress
  starts items as empty
  starts @item_count at 0
  
  when add_item(item)
    change items by + item
    calc @item_count plus 1 as new_count
    set @item_count to new_count
    fin
  
  when remove_item(item)
    change items by - item
    calc @item_count minus 1 as new_count
    set @item_count to new_count
    fin
  
  when bulk_add
    // Add multiple items in one event
    change items by + "item_1"
    change items by + "item_2"
    change items by + "item_3"
    change items by + "item_4"
    change items by + "item_5"
    calc @item_count plus 5 as new_count
    set @item_count to new_count
    fin
end

blueprint MathStress
  starts @result at 0
  
  when complex_math(a, b, c)
    // Chain of operations
    calc a plus b as sum
    calc sum times c as product
    calc product div 2 as half
    calc half rem 7 as remainder
    set @result to remainder
    fin
  
  when precision_test
    // Test floating point
    calc 1 div 3 as third
    calc third times 3 as should_be_one
    set @result to should_be_one
    fin
  
  when large_numbers
    calc 999999 times 999999 as big
    set @result to big
    fin
  
  when negative_math
    calc 0 minus 100 as neg
    calc neg times 2 as more_neg
    set @result to more_neg
    fin
end

blueprint BoundsTest
  starts @counter at 0
  starts @max_ops at 10000
  
  law PreventOverflow
    when @counter is above 1000000
    finfr  // Stop runaway counting
  
  when count_up
    calc @counter plus 1 as c
    set @counter to c
    fin
  
  when count_many(times)
    calc @counter plus times as c
    set @counter to c
    fin
end

blueprint MemoryPressure
  starts @data at ""
  starts @allocations at 0
  
  when allocate_string
    // Build up a large string
    memo chunk starts "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
    memo combined starts @data & chunk
    set @data to combined
    calc @allocations plus 1 as a
    set @allocations to a
    fin
  
  when clear_memory
    set @data to ""
    set @allocations to 0
    fin
end
