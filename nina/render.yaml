# render.yaml
# Newton Supercomputer - Single Service Deployment
# The API serves BOTH the backend AND the static frontend

services:
  - type: web
    name: newton-api
    runtime: python
    pythonVersion: "3.11.4"
    buildCommand: pip install --upgrade pip && pip install -r requirements.txt --only-binary=pydantic-core
    startCommand: gunicorn newton_supercomputer:app --workers 4 --worker-class uvicorn.workers.UvicornWorker --bind 0.0.0.0:$PORT --timeout 30 --keep-alive 5
    envVars:
      - key: PYTHONPATH
        value: /opt/render/project/src
      - key: PYTHONUNBUFFERED
        value: "1"
      - key: NEWTON_STORAGE
        value: /tmp/newton
      - key: WEB_CONCURRENCY
        value: "4"
    healthCheckPath: /health
    autoDeploy: true

# Routes served by newton-api:
#   /           → Newton Mission Control (dashboard)
#   /app        → Newton Supercomputer
#   /teachers   → Teacher's Aide
#   /builder    → Interface Builder
#   /ask        → Newton API
#   /docs       → API Documentation
#   /health     → Health check
