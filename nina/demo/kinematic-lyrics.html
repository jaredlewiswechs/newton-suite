<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Newton Kinematic Lyrics</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
            overflow-x: hidden;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        /* Album Art & Header */
        .player-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .album-art {
            width: 280px;
            height: 280px;
            border-radius: 12px;
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4, #45b7d1);
            margin: 0 auto 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 80px;
            animation: pulse 4s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .song-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }

        .artist-name {
            font-size: 18px;
            color: #ff6b6b;
            font-weight: 500;
        }

        /* Progress Bar */
        .progress-container {
            margin: 30px 0;
        }

        .progress-bar {
            height: 6px;
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
            cursor: pointer;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4);
            border-radius: 3px;
            width: 0%;
            transition: width 0.1s linear;
        }

        .time-display {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 13px;
            color: rgba(255,255,255,0.6);
            font-variant-numeric: tabular-nums;
        }

        /* Controls */
        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 32px;
            margin-bottom: 40px;
        }

        .control-btn {
            background: none;
            border: none;
            color: #fff;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 24px;
            opacity: 0.8;
        }

        .control-btn:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        .play-btn {
            width: 64px;
            height: 64px;
            background: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: #1a1a2e;
        }

        .play-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 30px rgba(255,255,255,0.3);
        }

        /* Lyrics Container */
        .lyrics-container {
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 40px 30px;
            min-height: 400px;
            position: relative;
            overflow: hidden;
        }

        .lyrics-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .lyrics-title {
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: rgba(255,255,255,0.5);
        }

        .kinematic-toggle {
            background: rgba(255,255,255,0.1);
            border: none;
            color: #fff;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .kinematic-toggle.active {
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4);
        }

        /* Lyrics Lines */
        .lyrics-scroll {
            position: relative;
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .lyric-line {
            padding: 16px 0;
            font-size: 24px;
            font-weight: 500;
            color: rgba(255,255,255,0.3);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            line-height: 1.4;
        }

        .lyric-line:hover {
            color: rgba(255,255,255,0.5);
        }

        .lyric-line.active {
            color: #fff;
            font-size: 28px;
            transform: scale(1.02);
        }

        .lyric-line.past {
            color: rgba(255,255,255,0.4);
        }

        /* Kinematic Analysis */
        .kinematic-data {
            display: none;
            margin-top: 8px;
            padding: 12px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            font-size: 12px;
            font-family: 'SF Mono', Monaco, monospace;
        }

        .kinematic-data.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .kinematic-row {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .kinematic-label {
            color: rgba(255,255,255,0.5);
        }

        .kinematic-value {
            color: #4ecdc4;
            font-weight: 600;
        }

        .kinematic-value.high { color: #4ecdc4; }
        .kinematic-value.medium { color: #ffd93d; }
        .kinematic-value.low { color: #ff6b6b; }

        /* Stability Bar */
        .stability-bar {
            height: 4px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
            margin-top: 8px;
            overflow: hidden;
        }

        .stability-fill {
            height: 100%;
            border-radius: 2px;
            transition: width 0.5s ease;
        }

        /* Word Breakdown */
        .word-breakdown {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 10px;
        }

        .word-chip {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .word-chip.anchor { background: rgba(78, 205, 196, 0.3); color: #4ecdc4; }
        .word-chip.flow { background: rgba(69, 183, 209, 0.3); color: #45b7d1; }
        .word-chip.energy { background: rgba(255, 107, 107, 0.3); color: #ff6b6b; }
        .word-chip.neutral { background: rgba(255,255,255,0.1); color: #fff; }

        /* Footer */
        .newton-badge {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            font-size: 12px;
            color: rgba(255,255,255,0.4);
        }

        .newton-badge a {
            color: #4ecdc4;
            text-decoration: none;
        }

        /* Visualizer */
        .visualizer {
            display: flex;
            justify-content: center;
            gap: 3px;
            height: 40px;
            align-items: flex-end;
            margin: 20px 0;
        }

        .viz-bar {
            width: 4px;
            background: linear-gradient(to top, #ff6b6b, #4ecdc4);
            border-radius: 2px;
            transition: height 0.1s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Player Header -->
        <div class="player-header">
            <div class="album-art">üíÖ</div>
            <h1 class="song-title">Bottom Bitch</h1>
            <p class="artist-name">Doja Cat</p>
        </div>

        <!-- Visualizer -->
        <div class="visualizer" id="visualizer"></div>

        <!-- Audio Element -->
        <audio id="audioPlayer" preload="auto">
            <source src="Doja Cat- Bottom Bitch.mp3" type="audio/mpeg">
        </audio>

        <!-- Audio Upload -->
        <div style="text-align: center; margin-bottom: 20px;">
            <label for="audioFile" style="background: rgba(255,255,255,0.1); padding: 10px 20px; border-radius: 20px; cursor: pointer; font-size: 14px;">
                üéµ Load MP3
            </label>
            <input type="file" id="audioFile" accept="audio/*" style="display: none;" onchange="loadAudio(event)">
        </div>

        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-bar" id="progressBar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="time-display">
                <span id="currentTime">0:00</span>
                <span id="totalTime">2:50</span>
            </div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <button class="control-btn" onclick="skipBack()">‚èÆ</button>
            <button class="control-btn play-btn" id="playBtn" onclick="togglePlay()">‚ñ∂</button>
            <button class="control-btn" onclick="skipForward()">‚è≠</button>
        </div>

        <!-- Lyrics Container -->
        <div class="lyrics-container">
            <div class="lyrics-header">
                <span class="lyrics-title">Lyrics</span>
                <button class="kinematic-toggle" id="kinematicToggle" onclick="toggleKinematic()">
                    ‚ö° Kinematic View
                </button>
            </div>
            <div class="lyrics-scroll" id="lyricsScroll">
                <!-- Lyrics will be injected here -->
            </div>
        </div>

        <div class="newton-badge">
            Powered by <a href="#">Newton Kinematic Linguistics</a><br>
            Word geometry ‚Ä¢ Stability analysis ‚Ä¢ Flow detection
        </div>
    </div>

    <script>
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // KINEMATIC LINGUISTICS ENGINE (Browser Version)
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        const GLYPH_DATA = {
            'A': { stability: 0.9, type: 'anchor', vector: 'Static equilibrium' },
            'B': { stability: 0.7, type: 'containment', vector: 'Pressure vessel' },
            'C': { stability: 0.4, type: 'flow', vector: 'Open capture' },
            'D': { stability: 0.75, type: 'containment', vector: 'Sealed pressure' },
            'E': { stability: 0.5, type: 'flow', vector: 'Multi-level output' },
            'F': { stability: 0.55, type: 'energy', vector: 'Cantilever load' },
            'G': { stability: 0.45, type: 'flow', vector: 'Spiral capture' },
            'H': { stability: 0.85, type: 'anchor', vector: 'Bridge structure' },
            'I': { stability: 0.95, type: 'anchor', vector: 'Vertical axis' },
            'J': { stability: 0.35, type: 'flow', vector: 'Hook/redirect' },
            'K': { stability: 0.6, type: 'energy', vector: 'Angular force' },
            'L': { stability: 0.5, type: 'flow', vector: 'Right angle flow' },
            'M': { stability: 0.88, type: 'anchor', vector: 'Mountain stability' },
            'N': { stability: 0.8, type: 'anchor', vector: 'Diagonal brace' },
            'O': { stability: 0.7, type: 'containment', vector: 'Complete enclosure' },
            'P': { stability: 0.6, type: 'energy', vector: 'Pressurized head' },
            'Q': { stability: 0.4, type: 'flow', vector: 'Leak/escape' },
            'R': { stability: 0.65, type: 'energy', vector: 'Grounded force' },
            'S': { stability: 0.3, type: 'flow', vector: 'Serpentine path' },
            'T': { stability: 0.92, type: 'anchor', vector: 'Cross brace' },
            'U': { stability: 0.5, type: 'containment', vector: 'Open vessel' },
            'V': { stability: 0.55, type: 'energy', vector: 'Convergent force' },
            'W': { stability: 0.82, type: 'anchor', vector: 'Wave stability' },
            'X': { stability: 0.7, type: 'energy', vector: 'Cross tension' },
            'Y': { stability: 0.45, type: 'flow', vector: 'Divergent split' },
            'Z': { stability: 0.35, type: 'energy', vector: 'Zigzag energy' }
        };

        function analyzeWord(word) {
            const upper = word.toUpperCase().replace(/[^A-Z]/g, '');
            if (!upper) return { stability: 0.5, type: 'neutral', dominant: 'unknown' };

            let totalStability = 0;
            let types = { anchor: 0, flow: 0, energy: 0, containment: 0 };

            for (const char of upper) {
                const glyph = GLYPH_DATA[char];
                if (glyph) {
                    totalStability += glyph.stability;
                    types[glyph.type]++;
                }
            }

            const avgStability = totalStability / upper.length;
            const dominant = Object.entries(types).sort((a, b) => b[1] - a[1])[0][0];

            return {
                word: word,
                stability: Math.min(1, avgStability),
                dominant: dominant,
                length: upper.length,
                anchors: types.anchor,
                flow: types.flow,
                energy: types.energy
            };
        }

        function analyzeLine(line) {
            const words = line.split(/\s+/).filter(w => w.length > 0);
            const wordAnalyses = words.map(analyzeWord);

            const avgStability = wordAnalyses.reduce((s, w) => s + w.stability, 0) / words.length || 0.5;
            const totalAnchors = wordAnalyses.reduce((s, w) => s + w.anchors, 0);
            const totalFlow = wordAnalyses.reduce((s, w) => s + w.flow, 0);
            const totalEnergy = wordAnalyses.reduce((s, w) => s + w.energy, 0);

            let prediction = 'balanced';
            if (avgStability > 0.7) prediction = 'stable';
            else if (avgStability < 0.4) prediction = 'unstable';
            else if (totalFlow > totalAnchors) prediction = 'flowing';
            else if (totalEnergy > totalAnchors) prediction = 'energetic';

            return {
                text: line,
                words: wordAnalyses,
                stability: avgStability,
                anchors: totalAnchors,
                flow: totalFlow,
                energy: totalEnergy,
                prediction: prediction,
                stabilityClass: avgStability > 0.7 ? 'high' : avgStability > 0.4 ? 'medium' : 'low'
            };
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // LYRICS DATA (with timestamps)
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        const LYRICS = [
            { time: 0, text: "Ooh, that's my trick" },
            { time: 2, text: "I'm her pimp" },
            { time: 3.5, text: "She my flip" },
            { time: 5, text: "Ooh, don't forget" },
            { time: 7, text: "That's my trick" },
            { time: 8.5, text: "She my bottom bitch" },
            { time: 10, text: "Ooh, that's my trick" },
            { time: 12, text: "I'm her pimp" },
            { time: 13.5, text: "She my flip" },
            { time: 15, text: "Ooh, don't forget" },
            { time: 17, text: "That's my trick" },
            { time: 18.5, text: "She my bottom bitch" },
            { time: 21, text: "" },
            { time: 22, text: "That's my ho" },
            { time: 23.5, text: "That's my doe" },
            { time: 25, text: "That's my glow up" },
            { time: 27, text: "She go hard" },
            { time: 28.5, text: "She just like a pro" },
            { time: 30, text: "She just wanna blow up" },
            { time: 32, text: "If you talkin' shit" },
            { time: 34, text: "Wipe your spit off my nuts" },
            { time: 36, text: "Nigga, grow up" },
            { time: 38, text: "On a boat like I'm Noah" },
            { time: 40, text: "Xan like I'm Noah" },
            { time: 42, text: "Damn, I don't know her no more" },
            { time: 44, text: "And she bought a crib" },
            { time: 46, text: "Then she bought a whip" },
            { time: 48, text: "In her Prada fit" },
            { time: 50, text: "Got some Gucci kicks" },
            { time: 52, text: "That's my bottom bitch" },
            { time: 54, text: "'Cause she 'bout it, bitch" },
            { time: 56, text: "And I'm proud of it" },
            { time: 58, text: "" },
            { time: 60, text: "Ooh, that's my trick" },
            { time: 62, text: "I'm her pimp" },
            { time: 63.5, text: "She my flip" },
            { time: 65, text: "Ooh, don't forget" },
            { time: 67, text: "That's my trick" },
            { time: 68.5, text: "She my bottom bitch" },
            { time: 70, text: "Ooh, that's my trick" },
            { time: 72, text: "I'm her pimp" },
            { time: 73.5, text: "She my flip" },
            { time: 75, text: "Ooh, don't forget" },
            { time: 77, text: "That's my trick" },
            { time: 78.5, text: "She my bottom bitch" },
            { time: 81, text: "" },
            { time: 82, text: "She don't create no problems" },
            { time: 84, text: "That's why the bitch my bottom" },
            { time: 86, text: "And she like a model, oh whoa" },
            { time: 89, text: "She ain't no rat, she possum" },
            { time: 91, text: "All up in that concoction" },
            { time: 93, text: "Personal coochie popper, oh" },
            { time: 96, text: "Slip in to something pretty" },
            { time: 98, text: "I need to be this fitted" },
            { time: 100, text: "Baby gon' get her way, yeah, oh whoa" },
            { time: 103, text: "Baby, don't keep me waitin'" },
            { time: 105, text: "Baby boy, what you payin'?" },
            { time: 107, text: "Drop it and I will stay with you" },
            { time: 110, text: "'Cause I know what you want, don't lie" },
            { time: 113, text: "You want something for one night" },
            { time: 116, text: "" },
            { time: 118, text: "Ooh, that's my trick" },
            { time: 120, text: "I'm her pimp" },
            { time: 121.5, text: "She my flip" },
            { time: 123, text: "Ooh, don't forget" },
            { time: 125, text: "That's my trick" },
            { time: 126.5, text: "She my bottom bitch" },
            { time: 128, text: "Ooh, that's my trick" },
            { time: 130, text: "I'm her pimp" },
            { time: 131.5, text: "She my flip" },
            { time: 133, text: "Ooh, don't forget" },
            { time: 135, text: "That's my trick" },
            { time: 136.5, text: "She my bottom bitch" },
            { time: 139, text: "" },
            { time: 140, text: "Ooh, that's my trick" },
            { time: 142, text: "I'm her pimp, she my flip" },
            { time: 144, text: "Ooh, don't forget" },
            { time: 146, text: "That's my trick, bottom bitch" },
            { time: 148, text: "Ooh, that's my trick" },
            { time: 150, text: "I'm her pimp, she my flip" },
            { time: 152, text: "Ooh, don't forget" },
            { time: 154, text: "That's my trick, bottom bitch" },
            { time: 156, text: "" },
            { time: 158, text: "Ooh" },
            { time: 160, text: "Ooh" },
            { time: 162, text: "Ooh" },
            { time: 165, text: "üéµ" }
        ];

        const TOTAL_DURATION = 170; // seconds

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // PLAYER STATE
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        let isPlaying = false;
        let currentTime = 0;
        let showKinematic = false;
        let animationFrame = null;
        let lastTimestamp = null;
        let audioElement = null;
        let hasAudio = false;

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // AUDIO FUNCTIONS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function loadAudio(event) {
            const file = event.target.files[0];
            if (file) {
                const url = URL.createObjectURL(file);
                audioElement = document.getElementById('audioPlayer');
                audioElement.src = url;
                audioElement.load();
                hasAudio = true;
                
                audioElement.onloadedmetadata = () => {
                    document.getElementById('totalTime').textContent = formatTime(audioElement.duration);
                };
                
                audioElement.ontimeupdate = () => {
                    if (hasAudio) {
                        currentTime = audioElement.currentTime;
                        updateDisplay();
                    }
                };
                
                audioElement.onended = () => {
                    isPlaying = false;
                    document.getElementById('playBtn').textContent = '‚ñ∂';
                };
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // INITIALIZE
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function init() {
            renderLyrics();
            createVisualizer();
            updateDisplay();
        }

        function renderLyrics() {
            const container = document.getElementById('lyricsScroll');
            container.innerHTML = LYRICS.map((lyric, index) => {
                if (!lyric.text) return `<div class="lyric-line" data-index="${index}">&nbsp;</div>`;

                const analysis = analyzeLine(lyric.text);
                const stabilityColor = analysis.stabilityClass === 'high' ? '#4ecdc4' :
                                       analysis.stabilityClass === 'medium' ? '#ffd93d' : '#ff6b6b';

                return `
                    <div class="lyric-line" data-index="${index}" onclick="seekTo(${lyric.time})">
                        ${lyric.text}
                        <div class="kinematic-data" id="kinematic-${index}">
                            <div class="kinematic-row">
                                <span class="kinematic-label">Stability</span>
                                <span class="kinematic-value ${analysis.stabilityClass}">${(analysis.stability * 100).toFixed(0)}%</span>
                            </div>
                            <div class="kinematic-row">
                                <span class="kinematic-label">Prediction</span>
                                <span class="kinematic-value">${analysis.prediction}</span>
                            </div>
                            <div class="kinematic-row">
                                <span class="kinematic-label">Anchors / Flow / Energy</span>
                                <span class="kinematic-value">${analysis.anchors} / ${analysis.flow} / ${analysis.energy}</span>
                            </div>
                            <div class="stability-bar">
                                <div class="stability-fill" style="width: ${analysis.stability * 100}%; background: ${stabilityColor}"></div>
                            </div>
                            <div class="word-breakdown">
                                ${analysis.words.map(w => `
                                    <span class="word-chip ${w.dominant}">${w.word}</span>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function createVisualizer() {
            const viz = document.getElementById('visualizer');
            for (let i = 0; i < 32; i++) {
                const bar = document.createElement('div');
                bar.className = 'viz-bar';
                bar.style.height = '4px';
                viz.appendChild(bar);
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // PLAYBACK
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function togglePlay() {
            isPlaying = !isPlaying;
            document.getElementById('playBtn').textContent = isPlaying ? '‚è∏' : '‚ñ∂';

            if (hasAudio) {
                audioElement = document.getElementById('audioPlayer');
                if (isPlaying) {
                    audioElement.play();
                    animateVisualizer();
                } else {
                    audioElement.pause();
                    cancelAnimationFrame(animationFrame);
                }
            } else {
                // Fallback to simulated playback
                if (isPlaying) {
                    lastTimestamp = performance.now();
                    animate();
                } else {
                    cancelAnimationFrame(animationFrame);
                }
            }
        }

        function animateVisualizer() {
            if (!isPlaying) return;
            updateVisualizer();
            animationFrame = requestAnimationFrame(animateVisualizer);
        }

        function animate() {
            if (!isPlaying) return;

            const now = performance.now();
            const delta = (now - lastTimestamp) / 1000;
            lastTimestamp = now;

            currentTime += delta;
            if (currentTime >= TOTAL_DURATION) {
                currentTime = 0;
            }

            updateDisplay();
            updateVisualizer();

            animationFrame = requestAnimationFrame(animate);
        }

        function updateDisplay() {
            // Update progress bar
            const progress = (currentTime / TOTAL_DURATION) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;

            // Update time display
            document.getElementById('currentTime').textContent = formatTime(currentTime);

            // Update active lyric
            let activeIndex = 0;
            for (let i = LYRICS.length - 1; i >= 0; i--) {
                if (currentTime >= LYRICS[i].time) {
                    activeIndex = i;
                    break;
                }
            }

            document.querySelectorAll('.lyric-line').forEach((line, index) => {
                line.classList.remove('active', 'past');
                if (index === activeIndex) {
                    line.classList.add('active');
                    // Scroll to center
                    const container = document.getElementById('lyricsScroll');
                    const offset = line.offsetTop - 150;
                    container.style.transform = `translateY(-${Math.max(0, offset)}px)`;
                } else if (index < activeIndex) {
                    line.classList.add('past');
                }
            });
        }

        function updateVisualizer() {
            const bars = document.querySelectorAll('.viz-bar');
            bars.forEach((bar, i) => {
                const height = isPlaying ? 
                    4 + Math.random() * 32 * (0.5 + 0.5 * Math.sin(currentTime * 3 + i * 0.5)) :
                    4;
                bar.style.height = `${height}px`;
            });
        }

        function seekTo(time) {
            currentTime = time;
            if (hasAudio) {
                document.getElementById('audioPlayer').currentTime = time;
            }
            updateDisplay();
        }

        function skipBack() {
            currentTime = Math.max(0, currentTime - 10);
            if (hasAudio) {
                document.getElementById('audioPlayer').currentTime = currentTime;
            }
            updateDisplay();
        }

        function skipForward() {
            currentTime = Math.min(TOTAL_DURATION, currentTime + 10);
            if (hasAudio) {
                document.getElementById('audioPlayer').currentTime = currentTime;
            }
            updateDisplay();
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // KINEMATIC TOGGLE
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function toggleKinematic() {
            showKinematic = !showKinematic;
            document.getElementById('kinematicToggle').classList.toggle('active', showKinematic);

            document.querySelectorAll('.kinematic-data').forEach(el => {
                el.classList.toggle('show', showKinematic);
            });
        }

        // Progress bar click
        document.getElementById('progressBar').addEventListener('click', (e) => {
            const rect = e.target.getBoundingClientRect();
            const percent = (e.clientX - rect.left) / rect.width;
            currentTime = percent * TOTAL_DURATION;
            if (hasAudio) {
                document.getElementById('audioPlayer').currentTime = currentTime;
            }
            updateDisplay();
        });

        // Initialize on load
        init();
    </script>
</body>
</html>
