<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>parcStation â€” HyperCard</title>
    <style>
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PARCSTATION HYPERCARD â€” PRODUCTION
           Stack â†’ Card â†’ Field â†’ Button
           localStorage persistence, full CRUD, Newton integration
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        :root {
            --white: #FFFFFF;
            --cream: #F5F5F0;
            --gray-100: #E8E8E3;
            --gray-200: #D1D1CC;
            --gray-500: #6E6E69;
            --gray-800: #2D2D28;
            --black: #1D1D1F;
            --blue: #007AFF;
            --green: #34C759;
            --orange: #FF9500;
            --red: #FF3B30;
            --purple: #AF52DE;
            
            --card-shadow: 0 2px 8px rgba(0,0,0,0.08), 0 1px 2px rgba(0,0,0,0.04);
            --card-shadow-hover: 0 8px 24px rgba(0,0,0,0.12), 0 2px 4px rgba(0,0,0,0.08);
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Helvetica Neue', sans-serif;
            background: var(--cream);
            color: var(--black);
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
        }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           MENU BAR
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .menubar {
            background: var(--white);
            border-bottom: 1px solid var(--gray-200);
            padding: 8px 16px;
            display: flex;
            align-items: center;
            gap: 20px;
            font-size: 14px;
            font-weight: 500;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .menubar .logo {
            font-weight: 700;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .menubar .logo span { color: var(--blue); }
        
        .menu-item {
            cursor: pointer;
            padding: 4px 10px;
            border-radius: 4px;
            transition: all 0.1s;
        }
        
        .menu-item:hover { background: var(--gray-100); }
        
        .menubar-right {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 16px;
            font-size: 13px;
        }
        
        .status {
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--gray-500);
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            background: var(--green);
            border-radius: 50%;
            transition: background 0.2s;
        }
        
        .status-dot.offline { background: var(--red); }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           MAIN LAYOUT
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 24px;
        }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           CARD COMPONENT
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .card {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            box-shadow: var(--card-shadow);
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .card-header {
            background: linear-gradient(to bottom, var(--gray-100), #E0E0DB);
            border-bottom: 1px solid var(--gray-200);
            padding: 10px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: default;
        }
        
        .card-title {
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .card-body { padding: 20px; }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           FORM ELEMENTS
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .field {
            width: 100%;
            padding: 12px 14px;
            border: 1px solid var(--gray-200);
            border-radius: 6px;
            font-size: 15px;
            font-family: inherit;
            background: var(--white);
            transition: all 0.15s;
        }
        
        .field:focus {
            outline: none;
            border-color: var(--blue);
            box-shadow: 0 0 0 3px rgba(0,122,255,0.12);
        }
        
        .field::placeholder { color: var(--gray-500); }
        
        .field-label {
            display: block;
            font-size: 11px;
            font-weight: 600;
            color: var(--gray-500);
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .form-row {
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }
        
        .form-row .field { flex: 1; }
        
        .form-group { margin-bottom: 16px; }
        .form-group:last-child { margin-bottom: 0; }
        
        textarea.field { resize: vertical; min-height: 80px; }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           BUTTONS
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 10px 18px;
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.1s;
            font-family: inherit;
        }
        
        .btn:hover {
            background: var(--gray-100);
            border-color: var(--gray-500);
        }
        
        .btn:active { transform: scale(0.98); }
        
        .btn-primary {
            background: var(--blue);
            border-color: var(--blue);
            color: white;
        }
        
        .btn-primary:hover {
            background: #0062CC;
            border-color: #0062CC;
        }
        
        .btn-danger { color: var(--red); }
        
        .btn-danger:hover {
            background: var(--red);
            border-color: var(--red);
            color: white;
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 13px;
        }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           RESPONSE DISPLAY
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        #response-card { display: none; }
        #response-card.visible { display: block; animation: slideIn 0.2s ease; }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-8px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .response-text {
            font-size: 17px;
            line-height: 1.6;
            margin-bottom: 12px;
            white-space: pre-wrap;
        }
        
        .response-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--gray-200);
            font-size: 13px;
            color: var(--gray-500);
        }
        
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            background: var(--gray-100);
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .badge.verified {
            background: rgba(52,199,89,0.12);
            color: var(--green);
        }
        
        .badge.error {
            background: rgba(255,59,48,0.12);
            color: var(--red);
        }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           STACKS GRID
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .stacks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
        }
        
        .stack-item {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.15s;
            position: relative;
        }
        
        .stack-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--card-shadow-hover);
            border-color: var(--blue);
        }
        
        .stack-item.new-stack {
            border-style: dashed;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 140px;
            color: var(--gray-500);
        }
        
        .stack-item.new-stack:hover {
            border-color: var(--blue);
            color: var(--blue);
            background: rgba(0,122,255,0.04);
        }
        
        .stack-icon {
            width: 44px;
            height: 44px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            margin-bottom: 12px;
            color: white;
        }
        
        .stack-item h3 {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .stack-item p {
            font-size: 13px;
            color: var(--gray-500);
            margin-bottom: 12px;
        }
        
        .stack-stats {
            display: flex;
            gap: 16px;
            font-size: 12px;
            color: var(--gray-500);
        }
        
        .stack-stats strong { color: var(--black); }
        .stack-stats .verified { color: var(--green); }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           MODAL
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.4);
            backdrop-filter: blur(4px);
            display: none;
            align-items: flex-start;
            justify-content: center;
            padding: 60px 20px;
            z-index: 200;
            overflow-y: auto;
        }
        
        .modal-overlay.visible { display: flex; }
        
        .modal {
            background: var(--white);
            border-radius: 12px;
            box-shadow: 0 24px 80px rgba(0,0,0,0.25);
            max-width: 600px;
            width: 100%;
            animation: modalIn 0.2s ease;
        }
        
        @keyframes modalIn {
            from { opacity: 0; transform: scale(0.96) translateY(-10px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }
        
        .modal-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .modal-header h2 {
            font-size: 17px;
            font-weight: 600;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 28px;
            line-height: 1;
            cursor: pointer;
            color: var(--gray-500);
            padding: 0 4px;
        }
        
        .modal-close:hover { color: var(--black); }
        
        .modal-body {
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .modal-footer {
            padding: 16px 20px;
            border-top: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            gap: 12px;
        }
        
        .modal-footer-right {
            display: flex;
            gap: 8px;
        }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           STACK VIEW (Inside Modal)
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .stack-card-item {
            background: var(--cream);
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.1s;
        }
        
        .stack-card-item:hover { border-color: var(--blue); }
        .stack-card-item:last-child { margin-bottom: 0; }
        
        .stack-card-claim {
            font-size: 15px;
            line-height: 1.5;
            margin-bottom: 8px;
            white-space: pre-wrap;
        }
        
        .stack-card-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 12px;
            color: var(--gray-500);
        }
        
        .stack-card-source {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .stack-card-actions {
            display: flex;
            gap: 8px;
        }
        
        .stack-card-actions button {
            background: none;
            border: none;
            color: var(--gray-500);
            cursor: pointer;
            padding: 4px;
            font-size: 14px;
            border-radius: 4px;
        }
        
        .stack-card-actions button:hover { color: var(--blue); background: var(--gray-100); }
        .stack-card-actions button.delete:hover { color: var(--red); }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray-500);
        }
        
        .empty-state p { margin-bottom: 16px; }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           TOOLS BAR
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .tools-bar {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .tool-btn {
            padding: 8px 14px;
            background: var(--gray-100);
            border: 1px solid var(--gray-200);
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.1s;
            display: flex;
            align-items: center;
            gap: 6px;
            font-family: inherit;
        }
        
        .tool-btn:hover {
            background: var(--blue);
            border-color: var(--blue);
            color: white;
        }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           COLOR PICKER
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .color-picker {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .color-option {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.1s;
        }
        
        .color-option:hover { transform: scale(1.1); }
        
        .color-option.selected {
            border-color: var(--black);
            box-shadow: 0 0 0 2px white, 0 0 0 4px var(--black);
        }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           TOAST NOTIFICATIONS
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .toast {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--gray-800);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            z-index: 300;
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .toast.visible {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        
        .toast.success { background: var(--green); }
        .toast.error { background: var(--red); }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           LOADING SPINNER
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid var(--gray-200);
            border-top-color: var(--blue);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Menu Bar -->
    <div class="menubar">
        <div class="logo">â—ˆ parc<span>Station</span></div>
        <span class="menu-item" onclick="location.reload()">Home</span>
        <span class="menu-item" onclick="exportData()">Export</span>
        <span class="menu-item" onclick="importData()">Import</span>
        <span class="menu-item" onclick="showAbout()">About</span>
        <div class="menubar-right">
            <div class="status">
                <span class="status-dot" id="status-dot"></span>
                <span id="status-text">Connecting...</span>
            </div>
            <span id="clock">--:--</span>
        </div>
    </div>
    
    <!-- Main Container -->
    <div class="container">
        
        <!-- Ask Newton -->
        <div class="card">
            <div class="card-header">
                <span class="card-title">ğŸ§  Ask Newton</span>
                <span style="font-size: 12px; color: var(--gray-500);">âŒ˜K to focus</span>
            </div>
            <div class="card-body">
                <div class="form-row">
                    <input type="text" class="field" id="question" placeholder="Ask anything..." autocomplete="off">
                    <button class="btn btn-primary" id="ask-btn" onclick="askNewton()">Ask</button>
                </div>
            </div>
        </div>
        
        <!-- Response -->
        <div class="card" id="response-card">
            <div class="card-header">
                <span class="card-title">ğŸ’¬ Response</span>
                <button class="btn btn-sm" onclick="saveResponseToStack()">Save to Stack</button>
            </div>
            <div class="card-body">
                <div class="response-text" id="response-text"></div>
                <div class="response-meta">
                    <span class="badge" id="response-verified"></span>
                    <span class="badge" id="response-model"></span>
                    <span class="badge" id="response-time"></span>
                </div>
            </div>
        </div>
        
        <!-- Tools -->
        <div class="card">
            <div class="card-header">
                <span class="card-title">ğŸ§° Tools</span>
            </div>
            <div class="card-body">
                <div class="tools-bar">
                    <button class="tool-btn" onclick="setQuestion('Calculate: ')">ğŸ”¢ Calculate</button>
                    <button class="tool-btn" onclick="setQuestion('Define: ')">ğŸ“– Define</button>
                    <button class="tool-btn" onclick="setQuestion('Wikipedia: ')">ğŸ“š Wikipedia</button>
                    <button class="tool-btn" onclick="setQuestion('Verify: ')">âœ“ Verify</button>
                    <button class="tool-btn" onclick="setQuestion('What is ')">â“ What is</button>
                    <button class="tool-btn" onclick="setQuestion('Explain ')">ğŸ’¡ Explain</button>
                </div>
            </div>
        </div>
        
        <!-- Stacks -->
        <div class="card">
            <div class="card-header">
                <span class="card-title">ğŸ“š Your Stacks</span>
                <button class="btn btn-sm btn-primary" onclick="showNewStackModal()">+ New Stack</button>
            </div>
            <div class="card-body">
                <div class="stacks-grid" id="stacks-grid"></div>
            </div>
        </div>
        
    </div>
    
    <!-- Stack View Modal -->
    <div class="modal-overlay" id="stack-modal" onclick="if(event.target===this)closeModal('stack-modal')">
        <div class="modal" style="max-width: 700px;">
            <div class="modal-header">
                <h2 id="stack-modal-title">Stack</h2>
                <button class="modal-close" onclick="closeModal('stack-modal')">Ã—</button>
            </div>
            <div class="modal-body" id="stack-modal-body"></div>
            <div class="modal-footer">
                <button class="btn btn-danger btn-sm" onclick="deleteCurrentStack()">Delete Stack</button>
                <div class="modal-footer-right">
                    <button class="btn" onclick="closeModal('stack-modal')">Close</button>
                    <button class="btn btn-primary" onclick="showAddCardModal()">+ Add Card</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- New Stack Modal -->
    <div class="modal-overlay" id="new-stack-modal" onclick="if(event.target===this)closeModal('new-stack-modal')">
        <div class="modal">
            <div class="modal-header">
                <h2>ğŸ“š New Stack</h2>
                <button class="modal-close" onclick="closeModal('new-stack-modal')">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="field-label">Stack Name</label>
                    <input class="field" id="new-stack-name" placeholder="e.g., Research Notes" autocomplete="off">
                </div>
                <div class="form-group">
                    <label class="field-label">Description</label>
                    <input class="field" id="new-stack-desc" placeholder="What's this stack for?" autocomplete="off">
                </div>
                <div class="form-group">
                    <label class="field-label">Icon</label>
                    <input class="field" id="new-stack-icon" placeholder="ğŸ“š" maxlength="2" style="width: 60px; text-align: center; font-size: 20px;">
                </div>
                <div class="form-group">
                    <label class="field-label">Color</label>
                    <div class="color-picker" id="color-picker">
                        <div class="color-option selected" data-color="#007AFF" style="background: linear-gradient(135deg, #007AFF, #0056CC);"></div>
                        <div class="color-option" data-color="#AF52DE" style="background: linear-gradient(135deg, #AF52DE, #8944AB);"></div>
                        <div class="color-option" data-color="#34C759" style="background: linear-gradient(135deg, #34C759, #248A3D);"></div>
                        <div class="color-option" data-color="#FF9500" style="background: linear-gradient(135deg, #FF9500, #CC7700);"></div>
                        <div class="color-option" data-color="#FF3B30" style="background: linear-gradient(135deg, #FF3B30, #CC2F26);"></div>
                        <div class="color-option" data-color="#5856D6" style="background: linear-gradient(135deg, #5856D6, #4644AB);"></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div></div>
                <div class="modal-footer-right">
                    <button class="btn" onclick="closeModal('new-stack-modal')">Cancel</button>
                    <button class="btn btn-primary" onclick="createStack()">Create Stack</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Card Modal -->
    <div class="modal-overlay" id="add-card-modal" onclick="if(event.target===this)closeModal('add-card-modal')">
        <div class="modal">
            <div class="modal-header">
                <h2>ğŸ“ Add Card</h2>
                <button class="modal-close" onclick="closeModal('add-card-modal')">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="field-label">Content</label>
                    <textarea class="field" id="new-card-content" rows="4" placeholder="Enter a claim, note, or fact..."></textarea>
                </div>
                <div class="form-group">
                    <label class="field-label">Source (optional)</label>
                    <input class="field" id="new-card-source" placeholder="e.g., Wikipedia, Texas GLO" autocomplete="off">
                </div>
                <div class="form-group" style="display: flex; align-items: center; gap: 8px;">
                    <input type="checkbox" id="new-card-verify" checked>
                    <label for="new-card-verify" style="font-size: 14px; cursor: pointer;">Verify with Newton</label>
                </div>
            </div>
            <div class="modal-footer">
                <div></div>
                <div class="modal-footer-right">
                    <button class="btn" onclick="closeModal('add-card-modal')">Cancel</button>
                    <button class="btn btn-primary" id="create-card-btn" onclick="createCard()">Create Card</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Save Response Modal -->
    <div class="modal-overlay" id="save-modal" onclick="if(event.target===this)closeModal('save-modal')">
        <div class="modal">
            <div class="modal-header">
                <h2>ğŸ’¾ Save to Stack</h2>
                <button class="modal-close" onclick="closeModal('save-modal')">Ã—</button>
            </div>
            <div class="modal-body" id="save-modal-body"></div>
            <div class="modal-footer">
                <div></div>
                <button class="btn" onclick="closeModal('save-modal')">Cancel</button>
            </div>
        </div>
    </div>
    
    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script>
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // PARCSTATION HYPERCARD â€” PRODUCTION ENGINE
        // localStorage persistence, full CRUD, Newton integration
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        const STORAGE_KEY = 'parcstation_stacks';
        const NEWTON_URL = 'http://localhost:8090';
        
        let stacks = [];
        let currentStackId = null;
        let lastResponse = null;
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // PERSISTENCE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function saveData() {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(stacks));
            } catch (e) {
                console.error('Failed to save:', e);
            }
        }
        
        function loadData() {
            try {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) {
                    stacks = JSON.parse(saved);
                } else {
                    initSampleData();
                }
            } catch (e) {
                console.error('Failed to load:', e);
                initSampleData();
            }
        }
        
        function initSampleData() {
            stacks = [
                {
                    id: generateId(),
                    name: 'Lewis Family',
                    description: 'Texas land records & genealogy',
                    icon: 'ğŸ“œ',
                    color: '#007AFF',
                    cards: [
                        { id: generateId(), content: 'Jasper Lewis owned 200 acres in Brazoria County in 1857', source: 'Texas GLO Patent #4521', verified: true, created: Date.now() - 86400000 },
                        { id: generateId(), content: 'The Lewis family arrived in Texas from Alabama in 1835', source: 'Family Bible records', verified: true, created: Date.now() - 172800000 }
                    ],
                    created: Date.now() - 604800000
                },
                {
                    id: generateId(),
                    name: 'Research Notes',
                    description: 'Academic papers & citations',
                    icon: 'ğŸ”¬',
                    color: '#AF52DE',
                    cards: [
                        { id: generateId(), content: 'The speed of light is approximately 299,792,458 m/s', source: 'Physics textbook', verified: true, created: Date.now() }
                    ],
                    created: Date.now() - 259200000
                }
            ];
            saveData();
        }
        
        function exportData() {
            const dataStr = JSON.stringify(stacks, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `parcstation_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showToast('Exported successfully', 'success');
        }
        
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                try {
                    const text = await file.text();
                    const imported = JSON.parse(text);
                    if (Array.isArray(imported)) {
                        stacks = imported;
                        saveData();
                        renderStacks();
                        showToast(`Imported ${stacks.length} stacks`, 'success');
                    } else {
                        showToast('Invalid file format', 'error');
                    }
                } catch (err) {
                    showToast('Failed to import: ' + err.message, 'error');
                }
            };
            input.click();
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // NEWTON API
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        async function checkNewtonStatus() {
            try {
                const res = await fetch(`${NEWTON_URL}/health`, { method: 'GET' });
                if (res.ok) {
                    document.getElementById('status-dot').classList.remove('offline');
                    document.getElementById('status-text').textContent = 'Newton Ready';
                    return true;
                }
            } catch (e) {}
            document.getElementById('status-dot').classList.add('offline');
            document.getElementById('status-text').textContent = 'Newton Offline';
            return false;
        }
        
        async function askNewton() {
            const question = document.getElementById('question').value.trim();
            if (!question) return;
            
            const responseCard = document.getElementById('response-card');
            responseCard.classList.add('visible');
            document.getElementById('response-text').innerHTML = '<span class="spinner"></span> Thinking...';
            document.getElementById('response-verified').textContent = '';
            document.getElementById('response-model').textContent = '';
            document.getElementById('response-time').textContent = '';
            
            try {
                const res = await fetch(`${NEWTON_URL}/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: question })
                });
                
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                
                const data = await res.json();
                
                // Extract text
                let text = data.content || data.response || data.answer || JSON.stringify(data);
                text = text.replace(/\n\nğŸ“š.*$/s, ''); // Clean up source line if embedded
                
                document.getElementById('response-text').textContent = text;
                
                // Verified badge
                const verifiedBadge = document.getElementById('response-verified');
                if (data.verified) {
                    verifiedBadge.className = 'badge verified';
                    verifiedBadge.textContent = 'âœ“ Verified';
                } else {
                    verifiedBadge.className = 'badge';
                    verifiedBadge.textContent = 'Unverified';
                }
                
                document.getElementById('response-model').textContent = data.model || 'Newton';
                document.getElementById('response-time').textContent = (data.elapsed_ms || '??') + 'ms';
                
                // Store for save
                lastResponse = { question, answer: text, verified: data.verified || false };
                
            } catch (e) {
                document.getElementById('response-text').textContent = 'Could not reach Newton. Make sure the agent is running on port 8090.';
                document.getElementById('response-verified').className = 'badge error';
                document.getElementById('response-verified').textContent = 'Error';
                console.error('Newton error:', e);
            }
        }
        
        async function verifyWithNewton(content) {
            try {
                const res = await fetch(`${NEWTON_URL}/ground`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ claim: content })
                });
                if (!res.ok) return false;
                const data = await res.json();
                return data.status === 'VERIFIED' || data.status === 'LIKELY' || data.verified === true;
            } catch (e) {
                // Fallback to chat verify
                try {
                    const res2 = await fetch(`${NEWTON_URL}/chat`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ message: `Verify: ${content}` })
                    });
                    if (!res2.ok) return false;
                    const data2 = await res2.json();
                    return data2.verified === true;
                } catch (e2) {
                    return false;
                }
            }
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // UI RENDERING
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function renderStacks() {
            const grid = document.getElementById('stacks-grid');
            
            let html = stacks.map(stack => {
                const totalCards = stack.cards.length;
                const verifiedCards = stack.cards.filter(c => c.verified).length;
                
                return `
                    <div class="stack-item" onclick="openStack('${stack.id}')">
                        <div class="stack-icon" style="background: linear-gradient(135deg, ${stack.color}, ${darkenColor(stack.color)});">${escapeHtml(stack.icon)}</div>
                        <h3>${escapeHtml(stack.name)}</h3>
                        <p>${escapeHtml(stack.description || 'No description')}</p>
                        <div class="stack-stats">
                            <span><strong>${totalCards}</strong> card${totalCards !== 1 ? 's' : ''}</span>
                            <span class="verified"><strong>${verifiedCards}</strong> verified</span>
                        </div>
                    </div>
                `;
            }).join('');
            
            html += `
                <div class="stack-item new-stack" onclick="showNewStackModal()">
                    <div style="font-size: 32px; margin-bottom: 8px;">+</div>
                    <h3>New Stack</h3>
                </div>
            `;
            
            grid.innerHTML = html;
        }
        
        function renderStackCards(stack) {
            const body = document.getElementById('stack-modal-body');
            
            if (!stack.cards || stack.cards.length === 0) {
                body.innerHTML = `
                    <div class="empty-state">
                        <p>No cards in this stack yet.</p>
                        <button class="btn btn-primary" onclick="showAddCardModal()">+ Add First Card</button>
                    </div>
                `;
                return;
            }
            
            body.innerHTML = stack.cards.map(card => `
                <div class="stack-card-item" data-card-id="${card.id}">
                    <div class="stack-card-claim">${escapeHtml(card.content)}</div>
                    <div class="stack-card-footer">
                        <div class="stack-card-source">
                            <span class="badge ${card.verified ? 'verified' : ''}">${card.verified ? 'âœ“ Verified' : 'Unverified'}</span>
                            ${card.source ? `<span>${escapeHtml(card.source)}</span>` : ''}
                        </div>
                        <div class="stack-card-actions">
                            <button onclick="reverifyCard('${stack.id}', '${card.id}')" title="Re-verify">ğŸ”„</button>
                            <button class="delete" onclick="deleteCard('${stack.id}', '${card.id}')" title="Delete">ğŸ—‘</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // STACK OPERATIONS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function openStack(stackId) {
            const stack = stacks.find(s => s.id === stackId);
            if (!stack) return;
            
            currentStackId = stackId;
            document.getElementById('stack-modal-title').textContent = `${stack.icon} ${stack.name}`;
            renderStackCards(stack);
            openModal('stack-modal');
        }
        
        function showNewStackModal() {
            document.getElementById('new-stack-name').value = '';
            document.getElementById('new-stack-desc').value = '';
            document.getElementById('new-stack-icon').value = 'ğŸ“š';
            document.querySelectorAll('.color-option').forEach((el, i) => {
                el.classList.toggle('selected', i === 0);
            });
            openModal('new-stack-modal');
            setTimeout(() => document.getElementById('new-stack-name').focus(), 100);
        }
        
        function createStack() {
            const name = document.getElementById('new-stack-name').value.trim();
            const desc = document.getElementById('new-stack-desc').value.trim();
            const icon = document.getElementById('new-stack-icon').value.trim() || 'ğŸ“š';
            const colorEl = document.querySelector('.color-option.selected');
            const color = colorEl ? colorEl.dataset.color : '#007AFF';
            
            if (!name) {
                document.getElementById('new-stack-name').focus();
                showToast('Please enter a stack name', 'error');
                return;
            }
            
            const newStack = {
                id: generateId(),
                name,
                description: desc,
                icon,
                color,
                cards: [],
                created: Date.now()
            };
            
            stacks.unshift(newStack);
            saveData();
            renderStacks();
            closeModal('new-stack-modal');
            showToast(`Created "${name}"`, 'success');
            
            // Open the new stack
            setTimeout(() => openStack(newStack.id), 200);
        }
        
        function deleteCurrentStack() {
            if (!currentStackId) return;
            
            const stack = stacks.find(s => s.id === currentStackId);
            if (!stack) return;
            
            if (!confirm(`Delete "${stack.name}" and all ${stack.cards.length} cards? This cannot be undone.`)) return;
            
            stacks = stacks.filter(s => s.id !== currentStackId);
            saveData();
            renderStacks();
            closeModal('stack-modal');
            currentStackId = null;
            showToast('Stack deleted', 'success');
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // CARD OPERATIONS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function showAddCardModal() {
            document.getElementById('new-card-content').value = '';
            document.getElementById('new-card-source').value = '';
            document.getElementById('new-card-verify').checked = true;
            openModal('add-card-modal');
            setTimeout(() => document.getElementById('new-card-content').focus(), 100);
        }
        
        async function createCard() {
            const content = document.getElementById('new-card-content').value.trim();
            const source = document.getElementById('new-card-source').value.trim();
            const shouldVerify = document.getElementById('new-card-verify').checked;
            
            if (!content) {
                document.getElementById('new-card-content').focus();
                showToast('Please enter card content', 'error');
                return;
            }
            
            if (!currentStackId) {
                showToast('No stack selected', 'error');
                return;
            }
            
            const stack = stacks.find(s => s.id === currentStackId);
            if (!stack) return;
            
            // Disable button during verification
            const btn = document.getElementById('create-card-btn');
            const originalText = btn.textContent;
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner"></span> Verifying...';
            
            let verified = false;
            if (shouldVerify) {
                verified = await verifyWithNewton(content);
            }
            
            const newCard = {
                id: generateId(),
                content,
                source,
                verified,
                created: Date.now()
            };
            
            stack.cards.unshift(newCard);
            saveData();
            renderStackCards(stack);
            renderStacks();
            closeModal('add-card-modal');
            
            btn.disabled = false;
            btn.textContent = originalText;
            
            showToast(verified ? 'Card created & verified âœ“' : 'Card created', verified ? 'success' : '');
        }
        
        async function reverifyCard(stackId, cardId) {
            const stack = stacks.find(s => s.id === stackId);
            if (!stack) return;
            
            const card = stack.cards.find(c => c.id === cardId);
            if (!card) return;
            
            // Visual feedback
            const cardEl = document.querySelector(`[data-card-id="${cardId}"]`);
            if (cardEl) cardEl.style.opacity = '0.6';
            
            card.verified = await verifyWithNewton(card.content);
            saveData();
            renderStackCards(stack);
            renderStacks();
            
            showToast(card.verified ? 'Verified âœ“' : 'Could not verify', card.verified ? 'success' : '');
        }
        
        function deleteCard(stackId, cardId) {
            const stack = stacks.find(s => s.id === stackId);
            if (!stack) return;
            
            if (!confirm('Delete this card?')) return;
            
            stack.cards = stack.cards.filter(c => c.id !== cardId);
            saveData();
            renderStackCards(stack);
            renderStacks();
            showToast('Card deleted');
        }
        
        function saveResponseToStack() {
            if (!lastResponse) {
                showToast('No response to save', 'error');
                return;
            }
            
            if (stacks.length === 0) {
                showToast('Create a stack first', 'error');
                return;
            }
            
            // Show stack picker
            const body = document.getElementById('save-modal-body');
            body.innerHTML = stacks.map(stack => `
                <div class="stack-item" onclick="saveToStack('${stack.id}')" style="margin-bottom: 12px;">
                    <div class="stack-icon" style="background: linear-gradient(135deg, ${stack.color}, ${darkenColor(stack.color)}); width: 36px; height: 36px; font-size: 18px;">${escapeHtml(stack.icon)}</div>
                    <h3>${escapeHtml(stack.name)}</h3>
                    <p>${stack.cards.length} cards</p>
                </div>
            `).join('');
            
            openModal('save-modal');
        }
        
        function saveToStack(stackId) {
            const stack = stacks.find(s => s.id === stackId);
            if (!stack || !lastResponse) return;
            
            const newCard = {
                id: generateId(),
                content: `Q: ${lastResponse.question}\n\nA: ${lastResponse.answer}`,
                source: 'Newton Agent',
                verified: lastResponse.verified,
                created: Date.now()
            };
            
            stack.cards.unshift(newCard);
            saveData();
            renderStacks();
            closeModal('save-modal');
            showToast(`Saved to "${stack.name}"`, 'success');
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // MODAL HELPERS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function openModal(id) {
            document.getElementById(id).classList.add('visible');
        }
        
        function closeModal(id) {
            document.getElementById(id).classList.remove('visible');
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // UTILITIES
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function generateId() {
            return 'id_' + Date.now().toString(36) + Math.random().toString(36).substr(2, 9);
        }
        
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function darkenColor(hex) {
            const num = parseInt(hex.slice(1), 16);
            const r = Math.max(0, (num >> 16) - 40);
            const g = Math.max(0, ((num >> 8) & 0x00FF) - 40);
            const b = Math.max(0, (num & 0x0000FF) - 40);
            return `#${(r << 16 | g << 8 | b).toString(16).padStart(6, '0')}`;
        }
        
        function setQuestion(prefix) {
            const field = document.getElementById('question');
            field.value = prefix;
            field.focus();
            field.setSelectionRange(prefix.length, prefix.length);
        }
        
        function updateClock() {
            document.getElementById('clock').textContent = 
                new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
        }
        
        function showToast(message, type = '') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast' + (type ? ' ' + type : '');
            toast.classList.add('visible');
            setTimeout(() => toast.classList.remove('visible'), 3000);
        }
        
        function showAbout() {
            alert('parcStation HyperCard\nVersion 1.0.0\n\nStack â†’ Card â†’ Field â†’ Button\n\nPowered by Newton Supercomputer');
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // EVENT LISTENERS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        document.getElementById('question').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') askNewton();
        });
        
        // Color picker
        document.querySelectorAll('.color-option').forEach(el => {
            el.addEventListener('click', () => {
                document.querySelectorAll('.color-option').forEach(o => o.classList.remove('selected'));
                el.classList.add('selected');
            });
        });
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Escape closes modals
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal-overlay.visible').forEach(m => m.classList.remove('visible'));
            }
            // Cmd/Ctrl+K focuses search
            if (e.key === 'k' && (e.metaKey || e.ctrlKey)) {
                e.preventDefault();
                document.getElementById('question').focus();
            }
            // Cmd/Ctrl+N new card (if stack open)
            if (e.key === 'n' && (e.metaKey || e.ctrlKey) && currentStackId) {
                e.preventDefault();
                showAddCardModal();
            }
        });
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // INIT
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        loadData();
        renderStacks();
        checkNewtonStatus();
        updateClock();
        setInterval(updateClock, 1000);
        setInterval(checkNewtonStatus, 30000);
        
        console.log('parcStation HyperCard loaded');
        console.log(`${stacks.length} stacks, ${stacks.reduce((a, s) => a + s.cards.length, 0)} cards`);
    </script>
</body>
</html>
